<launch>

  <arg name="uav_name" default="$(optenv UAV_NAME uav)"/>
  <arg name="realsense_tf_prefix" default="$(arg uav_name)/rs_d435" />

  <arg name="debug" default="false" />
  <arg unless="$(arg debug)" name="launch_prefix" value=""/>
  <arg     if="$(arg debug)" name="launch_prefix" value="debug_roslaunch"/>

  <arg name="manager" default="object_localization_nodelet_manager" />
  <arg name="bluefox3_name" default="bluefox3_front" />
  <arg name="bluefox3_frame" default="$(arg uav_name)/$(arg bluefox3_name)" />

  <group ns="$(arg uav_name)">

    <node pkg="nodelet" type="nodelet" name="$(arg manager)" args="manager" output="screen" launch-prefix="$(arg launch_prefix)">
      <param name="num_worker_threads" value="16" />
    </node>

    <!-- Realsense D435 TFs -->
    <arg name="fcu_frame" default="$(arg uav_name)/fcu" />
    <arg name="fcu_frame_slashless" default="fcu_$(arg uav_name)" />
    <arg name="realsense_frame" default="$(arg realsense_tf_prefix)/link" />
    <arg name="realsense_frame_slashless" default="$(arg uav_name)_rs_d435_link" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="$(arg fcu_frame_slashless)_to_$(arg realsense_frame_slashless)" args="0.32 -0.01 -0.03 0 0 0 $(arg fcu_frame) $(arg realsense_frame)" />

    <!-- Bluefox3 TFs -->
    <arg name="bluefox3_frame_slashless" default="$(arg uav_name)_$(arg bluefox3_name)" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="$(arg fcu_frame_slashless)_to_$(arg bluefox3_frame_slashless)" args="0.32 0.0 0.0 1.5707963 3.1415927 1.5707963 $(arg fcu_frame) $(arg bluefox3_frame)" />

  </group>

  <!-- bluefox3 nodelet //{ -->
  <arg name="bluefox3_serial" default="$(env BLUEFOX3_FRONT)" />
  <arg name="bluefox3_calib_url" default="file://$(find mrs_general)/config/camera_calibrations/mv_$(arg bluefox3_serial).yaml" />

  <group ns="$(arg uav_name)" >
    <include file="$(find bluefox3)/launch/bluefox3.launch" >

      <!-- Camera Settings -->
      <arg name="serial" value="$(arg bluefox3_serial)" />
      <arg name="camera_name" value="$(arg bluefox3_name)" />
      <arg name="frame_id" value="$(arg bluefox3_frame)" />
      <arg name="calib_url" value="$(arg bluefox3_calib_url)" />

        <!-- Node Settings -->
      <arg name="plugin" value="true" />
      <arg name="manager" value="$(arg manager)" />
    </include>

  </group>
  <!-- //} -->

  <!-- Object detection Bluefox3 -->
  <include file="$(find object_detect)/launch/object_detect_bfx.launch">
    <arg name="standalone"  value="false" />
    <arg name="respawn"   value="true" />
    <arg name="manager"     value="$(arg manager)" />
  </include>
    
  <!-- Realsense high accuracy -->
  <include file="$(find realsense_d435)/launch/ball_catch.launch">
    <arg name="external_manager"   value="true" />
    <arg name="manager"            value="$(arg manager)" />
    <arg name="respawn"            value="true" />
    <arg name="tf_prefix"          value="$(arg realsense_tf_prefix)" />
  </include>

  <!-- Object detection Realsense -->
  <include file="$(find object_detect)/launch/object_detect.launch">
    <arg name="standalone"  value="false" />
    <arg name="respawn"     value="true" />
    <arg name="manager"     value="$(arg manager)" />
  </include>

  <!-- Depth detection Realsense -->
  <include file="$(find depth_detect)/launch/detect_depth.launch">
    <arg name="standalone"  value="false" />
    <arg name="respawn"     value="true" />
    <arg name="manager"     value="$(arg manager)" />
  </include>

  <!-- target filtration -->
</launch>
